<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics (GA4) - Replace G-QBV6VN2F9G with your Measurement ID -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QBV6VN2F9G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-QBV6VN2F9G');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resources - Triple Nickel</title>
    <link rel="stylesheet" href="shared-sidebar.css">
    <script src="shared-functions.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: white;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: clamp(10px, 2vw, 20px);
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        .main-container {
            max-width: 100%;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: row;
            overflow-x: hidden;
        }

        /* Page-specific styles for Resources */

        /* Nav button and sidebar header styles handled by shared-sidebar.css */

        .header {
            text-align: left;
            margin-bottom: clamp(30px, 5vh, 50px);
            max-width: 700px;
        }

        .title {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 800;
            font-family: 'Inter', sans-serif;
            margin-bottom: clamp(15px, 2vh, 25px);
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .title-icon {
            display: inline-block;
            margin-right: 12px;
        }

        .title-text {
            background: linear-gradient(135deg, #fff 0%, #e2e8f0 50%, #94a3b8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .title-accent {
            background: linear-gradient(135deg, #10b981 0%, #34d399 50%, #6ee7b7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: clamp(1rem, 2vw, 1.2rem);
            color: #94a3b8;
            line-height: 1.7;
            max-width: 600px;
        }

        .qr-share-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.4);
            border-radius: 12px;
            color: #10b981;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
        }

        .qr-share-btn:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.2));
            border-color: rgba(16, 185, 129, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .emoji {
            background: none !important;
            background-clip: unset !important;
            -webkit-background-clip: unset !important;
            -webkit-text-fill-color: initial !important;
            color: initial !important;
            font-style: normal !important;
            text-shadow: none !important;
            filter: none !important;
            display: inline-block;
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 350px), 1fr));
            gap: clamp(20px, 3vw, 40px);
            max-width: min(1400px, 100%);
            width: 100%;
        }

        .resource-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: clamp(20px, 3vh, 32px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            text-decoration: none;
            color: white;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            box-shadow: 
                0 4px 24px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.05) inset;
        }

        .resource-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .resource-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.05) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .resource-card:hover::before,
        .resource-card:hover::after {
            opacity: 1;
        }

        .resource-card > * {
            position: relative;
            z-index: 1;
        }

        .resource-card:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 20px 40px rgba(16, 185, 129, 0.15),
                0 0 0 1px rgba(16, 185, 129, 0.2) inset;
            border-color: rgba(16, 185, 129, 0.3);
        }

        .resource-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .resource-icon-wrapper {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            flex-shrink: 0;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3));
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .resource-title-section {
            flex: 1;
            min-width: 0;
        }

        .resource-title {
            font-size: clamp(1.2rem, 2.5vw, 1.5rem);
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.01em;
            background: linear-gradient(135deg, #10b981, #34d399);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .resource-tagline {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 500;
        }

        .resource-description {
            font-size: 0.9rem;
            color: #94a3b8;
            line-height: 1.6;
            margin-bottom: 20px;
            flex: 1;
        }

        .resource-button {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            width: 100%;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .resource-button::after {
            content: '‚Üí';
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }

        .resource-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        }

        .resource-button:hover::after {
            transform: translateX(4px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e293b 0%, #3b82f6 20%, #1e293b 100%);
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #475569;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            color: white;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .close {
            color: #94a3b8;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: white;
        }

        .modal h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #10b981, #34d399);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .score-sheet-generator {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border: 1px solid #475569;
        }

        .generator-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            width: 100%;
            min-width: 0;
            overflow: hidden;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #cbd5e1;
        }

        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border: 1px solid #475569;
            border-radius: 8px;
            font-size: 14px;
            background: rgba(30, 41, 59, 0.8);
            color: white;
            transition: border-color 0.3s ease;
            width: 100%;
            min-width: 0;
            max-width: 100%;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #10b981;
        }

        .game-rules {
            line-height: 1.6;
            color: #e2e8f0;
        }

        .game-rules h3 {
            color: #10b981;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .game-rules ul, .game-rules ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .game-rules li {
            margin-bottom: 8px;
        }

        .game-rules strong {
            color: #34d399;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
                width: 100vw;
                max-width: 100vw;
            }
            
            .main-container {
                flex-direction: column;
                width: 100%;
                max-width: 100vw;
                overflow-x: hidden;
            }
            
            .main-content {
                margin-left: 0 !important;
                padding: 20px;
                width: 100%;
                max-width: 100%;
                overflow-x: hidden;
                box-sizing: border-box;
            }
            
            .main-content.expanded {
                margin-left: 0;
            }
            
            .header {
                text-align: center;
                margin-bottom: 24px;
                max-width: 100%;
                padding: 0;
            }
            
            .title {
                font-size: clamp(1.8rem, 8vw, 2.5rem);
            }
            
            .subtitle {
                margin-left: auto;
                margin-right: auto;
                padding: 0 10px;
            }
            
            .resources-grid {
                gap: 16px;
                width: 100%;
                max-width: 100%;
            }
            
            .resource-card {
                padding: 20px;
                width: 100%;
            }
            
            .resource-header {
                gap: 12px;
                margin-bottom: 12px;
            }
            
            .resource-icon-wrapper {
                width: 48px;
                height: 48px;
                font-size: 1.4rem;
                flex-shrink: 0;
            }
            
            .resource-title-section {
                min-width: 0;
                overflow: hidden;
            }
            
            .resource-title {
                font-size: clamp(1rem, 4vw, 1.3rem);
            }
            
            .resource-description {
                font-size: 0.85rem;
                margin-bottom: 16px;
            }
            
            .resource-button {
                padding: 12px 20px;
                font-size: 0.85rem;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 20px;
            }

            .generator-form {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 12px;
            }
            
            .title {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 0.85rem;
            }
            
            .resource-card {
                padding: 16px;
                border-radius: 16px;
            }
            
            .resource-icon-wrapper {
                width: 44px;
                height: 44px;
                font-size: 1.2rem;
                border-radius: 12px;
            }
            
            .resource-title {
                font-size: 1.1rem;
            }
            
            .resource-tagline {
                font-size: 0.7rem;
            }
        }

        /* Accessibility: Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .resource-card:hover {
                transform: none;
            }
            
            .resource-button:hover::after {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <!-- Shared Navigation -->
    <div id="shared-navigation"></div>
    
    <div class="main-container">
        <div class="main-content">
            <div class="header">
                <h1 class="title">
                    <span class="title-accent">Resources</span>
                </h1>
                <p class="subtitle">
                    Comprehensive guides, tools, and references for mastering knife throwing competitions. From score sheets to tournament management, we've got you covered.
                </p>
                <button class="qr-share-btn" onclick="openModal('qrCodeModal')" title="Share App QR Code">
                    <span style="margin-right: 6px;">üì≤</span> Share App
                </button>
            </div>

            <div class="resources-grid">
                <div class="resource-card">
                    <div class="resource-header">
                        <div class="resource-icon-wrapper"><span class="emoji">üìÑ</span></div>
                        <div class="resource-title-section">
                            <h3 class="resource-title">Score Sheet Generator</h3>
                            <span class="resource-tagline">Custom printable sheets</span>
                        </div>
                    </div>
                    <p class="resource-description">
                        Generate custom score sheets for your knife throwing games and tournaments. Choose from various formats, customize max points per throw, and set your own distances.
                    </p>
                    <button class="resource-button" onclick="openModal('scoreSheetModal')">Generate</button>
                </div>

            <div class="resource-card">
                <div class="resource-header">
                    <div class="resource-icon-wrapper"><span class="emoji">üìñ</span></div>
                    <div class="resource-title-section">
                        <h3 class="resource-title">Game Rules</h3>
                        <span class="resource-tagline">Official rule reference</span>
                    </div>
                </div>
                <p class="resource-description">
                    Complete rules and explanations for all game modes including Custom Games, Quick Draw Tournaments, Walk Back, and more.
                </p>
                <button class="resource-button" onclick="openModal('gameRulesModal')">View Rules</button>
            </div>

            <div class="resource-card">
                <div class="resource-header">
                    <div class="resource-icon-wrapper"><span class="emoji">üéØ</span></div>
                    <div class="resource-title-section">
                        <h3 class="resource-title">How to Use</h3>
                        <span class="resource-tagline">Step-by-step guides</span>
                    </div>
                </div>
                <p class="resource-description">
                    Step-by-step guides on how to use all features of the app, from basic scoring to advanced tournament management.
                </p>
                <button class="resource-button" onclick="openModal('howToModal')">View Guide</button>
            </div>

            <div class="resource-card">
                <div class="resource-header">
                    <div class="resource-icon-wrapper"><span class="emoji">üèÜ</span></div>
                    <div class="resource-title-section">
                        <h3 class="resource-title">Tournaments</h3>
                        <span class="resource-tagline">Format explanations</span>
                    </div>
                </div>
                <p class="resource-description">
                    Learn about different tournament formats including Single Elimination, Double Elimination, Round Robin, and Conference style.
                </p>
                <button class="resource-button" onclick="openModal('tournamentModal')">Learn More</button>
            </div>
        </div>
        </div>
    </div>

    <!-- QR Code Share Modal -->
    <div id="qrCodeModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <span class="close" onclick="closeModal('qrCodeModal')">&times;</span>
            <h2><span class="emoji">üì≤</span> Share Triple Nickel Lite</h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">Scan this QR code to open the app on another device</p>
            <div style="background: white; padding: 20px; border-radius: 15px; display: inline-block; margin-bottom: 20px;">
                <img src="assets/TripleNickelLITE.png" alt="Triple Nickel Lite QR Code" style="max-width: 250px; width: 100%; height: auto; display: block;">
            </div>
            <p style="color: #64748b; font-size: 0.85rem;">
                Share this with fellow throwers so they can follow along on their own device!
            </p>
        </div>
    </div>

    <!-- Score Sheet Generator Modal -->
    <div id="scoreSheetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('scoreSheetModal')">&times;</span>
            <h2><span class="emoji">üìÑ</span> Score Sheet Generator</h2>
            <p>Generate custom score sheets for your knife throwing competitions.</p>
            
            <div class="score-sheet-generator">
                <div class="generator-form">
                    <div class="form-group">
                        <label for="eventName">Event Name</label>
                        <input type="text" id="eventName" placeholder="Enter event name" value="">
                    </div>
                    <div class="form-group">
                        <label for="gameName">Game Name</label>
                        <input type="text" id="gameName" placeholder="Enter game name" value="">
                    </div>
                    <div class="form-group">
                        <label for="weaponType">Game Type</label>
                        <select id="weaponType">
                            <option value="Knife">Knife</option>
                            <option value="Hawk">Hawk</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="discipline">Discipline</label>
                        <select id="discipline">
                            <option value="Rotational">Rotational</option>
                            <option value="No Spin">No Spin</option>
                            <option value="Half Spin">Half Spin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="roundCount">Number of Rounds</label>
                        <input type="number" id="roundCount" min="1" max="20" value="4">
                    </div>
                    <div class="form-group">
                        <label for="throwsPerRound">Throws per Round</label>
                        <input type="number" id="throwsPerRound" min="1" max="10" value="3">
                    </div>
                    <div class="form-group">
                        <label for="maxScore">Max Points per Throw</label>
                        <select id="maxScore" style="background: rgba(30, 41, 59, 0.8); border: 1px solid #475569; color: white; padding: 10px 12px; border-radius: 8px; font-size: 14px;">
                            <option value="1">1 Point</option>
                            <option value="2">2 Points</option>
                            <option value="3">3 Points</option>
                            <option value="4">4 Points</option>
                            <option value="5" selected>5 Points</option>
                            <option value="6">6 Points</option>
                            <option value="7">7 Points</option>
                            <option value="8">8 Points</option>
                            <option value="9">9 Points</option>
                            <option value="10">10 Points</option>
                            <option value="11">11 Points</option>
                            <option value="12">12 Points</option>
                            <option value="13">13 Points</option>
                            <option value="14">14 Points</option>
                            <option value="15">15 Points</option>
                            <option value="16">16 Points</option>
                            <option value="17">17 Points</option>
                            <option value="18">18 Points</option>
                            <option value="19">19 Points</option>
                            <option value="20">20 Points</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="numDistances">Number of Distances/Cards</label>
                        <input type="number" id="numDistances" min="1" max="10" value="5" onchange="updateDistanceInputs()">
                    </div>
                    <div class="form-group">
                        <label for="distancePreset">Game Preset</label>
                        <div style="display: flex; gap: 10px; align-items: flex-end; width: 100%; min-width: 0;">
                            <select id="distancePreset" onchange="updateDistanceInputs()" style="flex: 1; min-width: 0; max-width: 100%;">
                                <option value="" disabled selected>Select Game Preset</option>
                                <option value="" disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Default Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
                                <option value="dangerfest_am_knife">Dangerfest Am Knife (2m, 3m, 4m, 5m, 6m)</option>
                                <option value="dangerfest_pro_knife">Dangerfest Pro Knife (3m, 4m, 5m, 6m, 7m)</option>
                                <option value="dangerfest_am_hawk">Dangerfest Am Hawk (3m, 4m, 5m, 7m)</option>
                                <option value="dangerfest_pro_hawk">Dangerfest Pro Hawk (3m, 4m, 5m, 7m, 9m)</option>
                                <option value="akta">AKTA (7ft, 10ft, 13ft, 16ft)</option>
                                <option value="blade_aces_am_knife">Blade Aces Am Knife (2m, 3m, 4m, 5m)</option>
                                <option value="blade_aces_pro_knife">Blade Aces Pro Knife (3m, 4m, 5m, 6m, 7m)</option>
                                <option value="blade_aces_am_hawk">Blade Aces Am Hawk (3m, 4m, 5m)</option>
                                <option value="blade_aces_pro_hawk">Blade Aces Pro Hawk (3m, 4m, 5m, 7m, 9m)</option>
                                <option value="" disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Legacy Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
                                <option value="amateur">Amateur Knife (2m, 3m, 4m, 5m, 6m)</option>
                                <option value="professional">Pro Knife (3m, 4m, 5m, 6m, 7m)</option>
                            </select>
                            <button id="deletePresetBtn" onclick="deleteCustomPreset()" style="display: none; background: linear-gradient(45deg, #ef4444, #dc2626); border: none; color: white; padding: 10px 15px; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; flex-shrink: 0;" title="Delete Custom Preset">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Custom Distance Inputs (Collapsible) -->
                <div style="margin-top: 20px;">
                    <button type="button" id="toggleCustomDistances" onclick="toggleCustomDistances()" style="width: 100%; background: rgba(16, 185, 129, 0.1); border: 2px solid #10b981; border-radius: 10px; padding: 12px 20px; color: #10b981; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;">
                        <span>üìê Distance/Card Labels</span>
                        <span id="customDistancesToggleIcon" style="font-size: 1.2rem; transition: transform 0.3s ease;">‚ñº</span>
                    </button>
                    <div id="customDistanceInputs" style="display: none; margin-top: 15px; padding: 20px; background: rgba(16, 185, 129, 0.05); border: 1px solid #10b981; border-radius: 10px;">
                        <div id="distanceInputs" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <!-- Distance inputs will be generated dynamically -->
                        </div>
                    </div>
                </div>
                
                <!-- Save as Custom Preset Button -->
                <div id="savePresetContainer" style="display: none; margin-top: 20px; text-align: center;">
                    <button id="savePresetBtn" onclick="showSavePresetModal()" style="background: linear-gradient(45deg, #3b82f6, #2563eb); border: none; color: white; padding: 12px 24px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px;">
                        üíæ Save as Custom Preset
                    </button>
                </div>
                
                <button class="resource-button" onclick="generateScoreSheet()" style="margin-top: 20px;">Generate Score Sheet</button>
            </div>
        </div>
    </div>

    <!-- Game Rules Modal -->
    <div id="gameRulesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('gameRulesModal')">&times;</span>
            <h2><span class="emoji">üìñ</span> Game Rules</h2>
            <div class="game-rules">
                <h3>Custom Game</h3>
                <ul>
                    <li>Players take turns throwing knives at the target</li>
                    <li>Each player gets a set number of throws per round</li>
                    <li>Scores are based on where the knife lands (0 = miss, 5 = bullseye by default)</li>
                    <li>Special achievements: <strong>Bullseyes</strong> and <strong>Triple Nickels</strong> (three 5s in a row)</li>
                    <li>Tiebreaker modes available for tied games</li>
                </ul>

                <h3>Tournament Formats</h3>
                <ul>
                    <li><strong>Single Elimination:</strong> Lose once, you're out</li>
                    <li><strong>Double Elimination:</strong> Must lose twice to be eliminated</li>
                    <li><strong>Round Robin:</strong> Everyone plays everyone once</li>
                    <li><strong>Conference:</strong> NFL-style with Red and Blue conferences</li>
                </ul>

                <h3>Walk Back Game</h3>
                <ul>
                    <li>Players start at a close distance and move back after each round</li>
                    <li>Distances and maximum scores can be customized</li>
                    <li>Great for skill building and practice</li>
                </ul>

                <h3>Scoring System</h3>
                <ul>
                    <li>Configurable max score (default: 5 for bullseye)</li>
                    <li>Miss = 0 points</li>
                    <li>Bullseye = Maximum score (usually 5)</li>
                    <li><strong>Triple Nickel</strong> = Three maximum scores in a row (bonus achievement)</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- How To Modal -->
    <div id="howToModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('howToModal')">&times;</span>
            <h2><span class="emoji">üéØ</span> How to Use Triple Nickel Lite</h2>
            <div class="game-rules">
                <h3>What is Triple Nickel Lite?</h3>
                <p style="margin-bottom: 15px; color: #cbd5e1;">
                    Triple Nickel Lite is a free, browser-based score keeping utility for knife throwing. 
                    It runs entirely in your web browser - no downloads or installation required. 
                    Perfect for practice sessions, club nights, and casual competitions.
                </p>

                <h3>Walkback Games</h3>
                <p style="margin-bottom: 10px; color: #cbd5e1;">The classic knife throwing format where players progress through increasing distances.</p>
                <ol>
                    <li>Navigate to <strong>Walkback</strong> from the sidebar</li>
                    <li>Add players using the <strong>"Add Player"</strong> button</li>
                    <li>Select a game preset or customize your distances and throws</li>
                    <li>Click <strong>"Start Game"</strong> to begin scoring</li>
                    <li>Enter scores by clicking the score buttons (0-5) for each throw</li>
                    <li>Watch the <strong>Live Leaderboard</strong> update in real-time</li>
                    <li>View detailed stats in the <strong>After Game Report</strong> when finished</li>
                </ol>

                <h3>Side Games</h3>
                <p style="margin-bottom: 10px; color: #cbd5e1;">Fun alternative game modes for variety and practice.</p>
                <ul>
                    <li><strong>Golf:</strong> Target-based scoring where hitting your target scores 0 strokes. Progress through distances like golf holes - lowest total wins!</li>
                    <li><strong>Custom:</strong> Build your own game with customizable rounds, throws per round, and scoring rules</li>
                    <li><strong>Dagger & Die:</strong> A dice-based multiplayer combat game. Roll dice, throw at targets, and deal damage to opponents!</li>
                </ul>

                <h3>Key Features</h3>
                <ul>
                    <li><strong>Live Leaderboard:</strong> Real-time standings that update as you score</li>
                    <li><strong>Edit Scores:</strong> Click on any entered score to correct mistakes</li>
                    <li><strong>Player Names:</strong> Click on player names to customize them</li>
                    <li><strong>After Game Reports:</strong> Detailed statistics and round-by-round breakdowns</li>
                    <li><strong>Game Presets:</strong> Quick setup for popular formats (IKTHOF, Dangerfest, Blade Aces, AKTA)</li>
                    <li><strong>Score Sheet Generator:</strong> Create printable paper score sheets for manual scoring</li>
                </ul>

                <h3>Tips for Best Experience</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, rgba(168, 237, 234, 0.2), rgba(254, 214, 227, 0.2)); border: 1px solid #10b981; border-radius: 10px; padding: 15px;">
                        <h4 style="color: #10b981; margin-bottom: 10px; font-size: 1rem;">üì± Mobile Friendly</h4>
                        <ul style="font-size: 0.9rem; color: #e2e8f0; margin: 0; padding-left: 15px;">
                            <li>Works on phones and tablets</li>
                            <li>Touch-friendly score buttons</li>
                            <li>Responsive layout adapts to screen size</li>
                        </ul>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(116, 185, 255, 0.2), rgba(9, 132, 227, 0.2)); border: 1px solid #3b82f6; border-radius: 10px; padding: 15px;">
                        <h4 style="color: #3b82f6; margin-bottom: 10px; font-size: 1rem;">üíª Browser Based</h4>
                        <ul style="font-size: 0.9rem; color: #e2e8f0; margin: 0; padding-left: 15px;">
                            <li>No installation required</li>
                            <li>Works on any device with a browser</li>
                            <li>Data stays in your browser's local storage</li>
                        </ul>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(253, 121, 168, 0.2), rgba(232, 67, 147, 0.2)); border: 1px solid #ec4899; border-radius: 10px; padding: 15px;">
                        <h4 style="color: #ec4899; margin-bottom: 10px; font-size: 1rem;">üñ•Ô∏è Large Screen Setup</h4>
                        <ul style="font-size: 0.9rem; color: #e2e8f0; margin: 0; padding-left: 15px;">
                            <li>Use a laptop or tablet at your lane</li>
                            <li>Open the Leaderboard in a separate window</li>
                            <li>Display on a TV for spectators</li>
                        </ul>
                    </div>
                </div>
                
                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
                    <p style="margin: 0; font-size: 0.9rem; color: #cbd5e1;">
                        <strong>üí° Pro Tip:</strong> Bookmark Triple Nickel Lite for quick access. Your game data is saved in your browser, 
                        so you can close and reopen without losing progress. For the full desktop experience with additional features, 
                        check out the Triple Nickel desktop application.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tournament Modal -->
    <div id="tournamentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('tournamentModal')">&times;</span>
            <h2><span class="emoji">üèÜ</span> Tournament Formats</h2>
            <div class="game-rules" style="text-align: center; padding: 40px 20px;">
                <p style="font-size: 1.5rem; color: #fbbf24; margin-bottom: 15px;">Tournament Info Coming Soon!</p>
                <p style="color: #94a3b8;">We're working on bringing tournament support to Triple Nickel Lite. Stay tuned for updates!</p>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('statsModal')">&times;</span>
            <h2>üìä Statistics & Tracking</h2>
            <div class="game-rules">
                <h3>Basic Statistics</h3>
                <ul>
                    <li><strong>Total Score:</strong> Sum of all throws</li>
                    <li><strong>Average Score:</strong> Total score divided by number of throws</li>
                    <li><strong>Bullseyes:</strong> Number of maximum scores achieved</li>
                    <li><strong>Triple Nickels:</strong> Three maximum scores in a row</li>
                </ul>

                <h3>Game Statistics</h3>
                <ul>
                    <li><strong>Highest Score:</strong> Best performing player</li>
                    <li><strong>Lowest Score:</strong> Needs improvement</li>
                    <li><strong>Perfect Rounds:</strong> Rounds with all maximum scores</li>
                    <li><strong>Zero Rounds:</strong> Rounds with no successful throws</li>
                </ul>

                <h3>Tiebreaker Tracking</h3>
                <ul>
                    <li>Separate statistics for tiebreaker rounds</li>
                    <li>Multiple tiebreaker modes available</li>
                    <li>Detailed round-by-round breakdown</li>
                </ul>

                <h3>Export Options</h3>
                <ul>
                    <li>Complete game summary</li>
                    <li>Individual player statistics</li>
                    <li>Round-by-round breakdown</li>
                    <li>Text file format for easy sharing</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Tips Modal -->
    <div id="tipsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('tipsModal')">&times;</span>
            <h2>‚öôÔ∏è Tips & Tricks</h2>
            <div class="game-rules">
                <h3>App Usage Tips</h3>
                <ul>
                    <li>Use descriptive player names to avoid confusion</li>
                    <li>Configure game settings before starting</li>
                    <li>Take advantage of the edit feature for corrections</li>
                    <li>Export results for record keeping</li>
                </ul>

                <h3>Tournament Organization</h3>
                <ul>
                    <li>Choose tournament format based on time available</li>
                    <li>Consider skill levels when seeding players</li>
                    <li>Use Round Robin for fair competition</li>
                    <li>Double Elimination gives everyone a second chance</li>
                </ul>

                <h3>Competition Management</h3>
                <ul>
                    <li>Keep games moving with clear throwing order</li>
                    <li>Use the leaderboard to build excitement</li>
                    <li>Celebrate achievements like bullseyes and triple nickels</li>
                    <li>Save results for future reference</li>
                </ul>

                <h3>Skill Development</h3>
                <ul>
                    <li>Use Walk Back games for skill development</li>
                    <li>Track improvement over time</li>
                    <li>Focus on consistency over occasional high scores</li>
                    <li>Practice different distances and targets</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Success Modal for Score Sheet Generation -->
    <div id="successModal" class="modal">
        <div class="modal-content" style="max-width: 500px; text-align: center;">
            <span class="close" onclick="closeModal('successModal')">&times;</span>
            <div style="margin-bottom: 20px;">
                <div style="font-size: 4rem; color: #10b981; margin-bottom: 15px;">‚úÖ</div>
                <h2 style="color: #10b981; margin-bottom: 15px; font-size: 1.8rem;">Score Sheet Generated!</h2>
            </div>
            
            <div style="background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #10b981;">
                <p style="font-size: 1.1rem; color: #e2e8f0; margin-bottom: 15px; font-weight: 500;">
                    Your score sheet has been successfully generated and downloaded.
                </p>
                <div style="background: rgba(15, 23, 42, 0.8); padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <p style="color: #cbd5e1; margin-bottom: 8px; font-size: 0.9rem;">
                        <strong>üìÑ File Name:</strong>
                    </p>
                    <p id="generatedFileName" style="color: #34d399; font-family: monospace; font-size: 0.9rem; word-break: break-all; margin: 0;">
                        <!-- Filename will be inserted here -->
                    </p>
                </div>
            </div>
            
                            <div id="fileLocationInfo" style="background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #3b82f6;">
                    <h3 style="color: #3b82f6; margin-bottom: 15px; font-size: 1.2rem;">üìÅ Find Your Score Sheet</h3>
                    <div style="text-align: left; color: #e2e8f0;">
                        <p style="margin-bottom: 0; font-size: 0.95rem;">
                            <strong>üíª Windows:</strong> Check your Downloads folder or look for the download notification in your browser.
                        </p>
                    </div>
                </div>
                
                <div style="background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #10b981;">
                    <h3 style="color: #10b981; margin-bottom: 15px; font-size: 1.2rem;">‚öôÔ∏è Score Sheet Configuration</h3>
                    <div style="text-align: left; color: #e2e8f0;">
                        <p style="margin-bottom: 8px; font-size: 0.95rem;">
                            <strong>üéØ Max Points per Throw:</strong> <span id="generatedMaxScore">5</span>
                        </p>
                                                 <p style="margin-bottom: 8px; font-size: 0.95rem;">
                             <strong>üìä Score Range:</strong> 0 to <span id="generatedMaxScoreRange">5</span> points per throw
                         </p>
                        <p style="margin-bottom: 8px; font-size: 0.95rem;">
                            <strong>üìê Layout:</strong> <span id="generatedLayout">Standard grid layout</span>
                        </p>
                        <p style="margin-bottom: 0; font-size: 0.95rem;">
                            <strong>üìù Format:</strong> <span id="generatedFormatRange">0-5</span> selection boxes for each throw at each distance
                        </p>
                    </div>
                </div>
            
            <div style="display: flex; justify-content: center;">
                <button onclick="closeModal('successModal')" style="background: linear-gradient(45deg, #10b981, #059669); border: none; color: white; padding: 12px 24px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px;">
                    ‚úÖ Done
                </button>
            </div>
        </div>
    </div>

    <!-- Save Custom Preset Confirmation Modal -->
    <div id="savePresetModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeModal('savePresetModal')">&times;</span>
            <h2 style="margin-bottom: 20px;"><span class="emoji">üíæ</span> Save Custom Preset</h2>
            
            <div style="background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #10b981;">
                <p style="color: #e2e8f0; margin-bottom: 15px;">
                    Save your current settings as a custom preset named:
                </p>
                <div style="background: rgba(15, 23, 42, 0.8); padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                    <p id="presetNameDisplay" style="color: #34d399; font-size: 1.2rem; font-weight: bold; margin: 0;"></p>
                </div>
                <div id="presetNameError" style="color: #ef4444; font-size: 0.9rem; margin-top: 8px; display: none;"></div>
            </div>
            
            <div style="display: flex; justify-content: center; gap: 15px;">
                <button onclick="closeModal('savePresetModal')" style="background: #64748b; border: none; color: white; padding: 12px 24px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    Cancel
                </button>
                <button onclick="saveCustomPreset()" style="background: linear-gradient(45deg, #10b981, #059669); border: none; color: white; padding: 12px 24px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    üíæ Save Preset
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Preset Confirmation Modal -->
    <div id="deletePresetModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeModal('deletePresetModal')">&times;</span>
            <h2 style="margin-bottom: 20px;"><span class="emoji">üóëÔ∏è</span> Delete Custom Preset</h2>
            
            <div style="background: rgba(239, 68, 68, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #ef4444;">
                <p style="color: #e2e8f0; margin-bottom: 15px; font-size: 1.1rem;">
                    Are you sure you want to delete the preset:
                </p>
                <div style="background: rgba(15, 23, 42, 0.8); padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; border: 1px solid #ef4444;">
                    <p id="deletePresetName" style="color: #fca5a5; font-size: 1.2rem; font-weight: bold; margin: 0;"></p>
                </div>
                <p style="color: #fca5a5; font-size: 0.95rem; text-align: center; margin: 0;">
                    ‚ö†Ô∏è This action cannot be undone.
                </p>
            </div>
            
            <div style="display: flex; justify-content: center; gap: 15px;">
                <button onclick="closeModal('deletePresetModal')" style="background: #64748b; border: none; color: white; padding: 12px 24px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    Cancel
                </button>
                <button onclick="confirmDeletePreset()" style="background: linear-gradient(45deg, #ef4444, #dc2626); border: none; color: white; padding: 12px 24px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    üóëÔ∏è Delete Preset
                </button>
            </div>
        </div>
    </div>

    <script>
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            // If opening score sheet modal, reset form to defaults
            if (modalId === 'scoreSheetModal') {
                resetScoreSheetForm();
            }
        }

        function getEventNameFromManagement() {
            try {
                // First, check for tournament name (this is what the user sets in Management)
                const tournamentName = localStorage.getItem('tournamentName');
                console.log('Tournament name from localStorage:', tournamentName);
                
                if (tournamentName && tournamentName.trim() !== '') {
                    console.log('Using tournament name:', tournamentName);
                    return tournamentName.trim();
                }
                
                // Fallback: Check for events if no tournament name is set
                const eventsData = localStorage.getItem('tournamentEvents');
                console.log('No tournament name found, checking events...');
                console.log('Raw eventsData from localStorage:', eventsData);
                
                if (!eventsData || eventsData === '[]' || eventsData === 'null') {
                    console.log('No tournamentEvents found or array is empty');
                    return '';
                }
                
                const events = JSON.parse(eventsData);
                console.log('Parsed events:', events);
                console.log('Number of events:', events ? events.length : 0);
                
                if (!events || !Array.isArray(events) || events.length === 0) {
                    console.log('Events array is empty or invalid');
                    return '';
                }
                
                // Helper function to get sort value for an event
                const getSortValue = (event) => {
                    if (event.dateCreated) {
                        const date = new Date(event.dateCreated);
                        if (!isNaN(date.getTime())) {
                            return date.getTime();
                        }
                    }
                    // If id is a number (timestamp), use it directly
                    if (typeof event.id === 'number') {
                        return event.id;
                    }
                    // If id is a string that might contain a timestamp, try to extract it
                    if (typeof event.id === 'string') {
                        const numId = parseFloat(event.id);
                        if (!isNaN(numId) && numId > 1000000000000) { // Likely a timestamp
                            return numId;
                        }
                        // Try to extract timestamp from string like "1234567890.123"
                        const parts = event.id.split('.');
                        if (parts.length > 0) {
                            const mainId = parseFloat(parts[0]);
                            if (!isNaN(mainId) && mainId > 1000000000000) {
                                return mainId;
                            }
                        }
                    }
                    return 0;
                };
                
                // Get the most recently created event (regardless of status)
                const sortedEvents = [...events].sort((a, b) => {
                    const valA = getSortValue(a);
                    const valB = getSortValue(b);
                    return valB - valA; // Most recent first
                });
                
                const selectedEvent = sortedEvents[0];
                console.log('Selected event:', selectedEvent);
                
                if (selectedEvent && selectedEvent.name) {
                    console.log('Using event name:', selectedEvent.name);
                    return selectedEvent.name;
                }
                
                return '';
            } catch (error) {
                console.error('Error loading event name from Management:', error);
                console.error('Error details:', error.message, error.stack);
                return '';
            }
        }

        function resetScoreSheetForm() {
            console.log('resetScoreSheetForm called');
            
            // Load Event Name from Management if available
            const eventName = document.getElementById('eventName');
            console.log('Event name field found:', !!eventName);
            
            if (eventName) {
                const managementEventName = getEventNameFromManagement();
                console.log('Event name retrieved from Management:', managementEventName);
                console.log('Setting eventName.value to:', managementEventName || '');
                eventName.value = managementEventName || '';
                console.log('Event name field value after setting:', eventName.value);
            } else {
                console.error('Event name field not found!');
            }
            
            // Reset Game Name to blank
            const gameName = document.getElementById('gameName');
            if (gameName) {
                gameName.value = '';
            }
            
            // Reset Game Preset to placeholder
            const distancePreset = document.getElementById('distancePreset');
            if (distancePreset) {
                distancePreset.value = '';
                // Reset the tracking variable so presets can be configured again
                lastConfiguredPreset = null;
            }
            
            // Hide delete button
            const deleteBtn = document.getElementById('deletePresetBtn');
            if (deleteBtn) {
                deleteBtn.style.display = 'none';
            }
            
            // Hide custom distance inputs section
            const customInputs = document.getElementById('customDistanceInputs');
            const toggleIcon = document.getElementById('customDistancesToggleIcon');
            if (customInputs) {
                customInputs.style.display = 'none';
            }
            if (toggleIcon) {
                toggleIcon.textContent = '‚ñº';
                toggleIcon.style.transform = 'rotate(0deg)';
            }
            
            // Clear custom distance inputs
            const distanceInputs = document.getElementById('distanceInputs');
            if (distanceInputs) {
                distanceInputs.innerHTML = '';
            }
            
            // Reset manual changes flag
            hasManualChanges = false;
            
            // Hide save preset button
            const saveContainer = document.getElementById('savePresetContainer');
            if (saveContainer) {
                saveContainer.style.display = 'none';
            }
            
            // Update distance inputs to reflect the reset
            updateDistanceInputs();
        }

        function closeModal(modalId) {
            // If closing delete preset modal, clear the preset to delete
            if (modalId === 'deletePresetModal') {
                presetToDelete = null;
            }
            
            document.getElementById(modalId).style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    // If closing delete preset modal, clear the preset to delete
                    if (modal.id === 'deletePresetModal') {
                        presetToDelete = null;
                    }
                    
                    modal.style.display = 'none';
                }
            });
        }

        // Initialize distance inputs on page load
        window.onload = function() {
            updateDistanceInputs();
            // Check terms acceptance
            checkTermsAcceptance();
            // Initialize custom presets
            loadCustomPresets();
            initializePresetChangeTracking();
        };

        function updateDistanceInputs() {
            const distancePreset = document.getElementById('distancePreset').value;
            let numDistances = parseInt(document.getElementById('numDistances').value) || 5;
            const customInputs = document.getElementById('customDistanceInputs');
            const distanceInputs = document.getElementById('distanceInputs');
            const deleteBtn = document.getElementById('deletePresetBtn');
            
            // Show/hide delete button based on preset type
            if (deleteBtn) {
                if (distancePreset && distancePreset.startsWith('custom_')) {
                    deleteBtn.style.display = 'block';
                } else {
                    deleteBtn.style.display = 'none';
                }
            }
            
            // Check if this is a custom preset
            if (distancePreset && distancePreset.startsWith('custom_')) {
                // Reset tracking when loading custom preset
                lastConfiguredPreset = null;
                loadCustomPreset(distancePreset);
                return;
            }
            
            // Set loading flag for built-in presets
            if (distancePreset && !distancePreset.startsWith('custom_') && distancePreset !== '') {
                isLoadingPreset = true;
                // Only configure if this is a different preset
                configurePresetSettings(distancePreset);
                // Re-read numDistances after preset configuration (it may have been updated)
                numDistances = parseInt(document.getElementById('numDistances').value) || 5;
            }
            
            // Update distance inputs if the section is visible
            if (customInputs && customInputs.style.display !== 'none' && distanceInputs) {
                const currentInputCount = distanceInputs.children.length;
                
                // Get preset distances if a preset is selected
                let presetDistances = [];
                if (distancePreset && !distancePreset.startsWith('custom_') && distancePreset !== '') {
                    presetDistances = getDefaultDistances(distancePreset, numDistances);
                }
                
                // If count doesn't match, recreate all inputs
                if (currentInputCount !== numDistances) {
                    // Clear existing inputs
                    distanceInputs.innerHTML = '';
                    
                    // Create the correct number of inputs
                    for (let i = 0; i < numDistances; i++) {
                        const inputDiv = document.createElement('div');
                        inputDiv.style.cssText = 'display: flex; flex-direction: column;';
                        
                        const label = document.createElement('label');
                        label.style.cssText = 'font-size: 0.8rem; color: #94a3b8; margin-bottom: 5px;';
                        label.textContent = 'Variable ' + (i + 1);
                        
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.id = 'distance' + (i + 1);
                        input.placeholder = 'e.g., ' + (i + 2) + ' Meters';
                        input.maxLength = 20;
                        input.style.cssText = 'background: #475569; border: 1px solid #64748b; color: white; padding: 8px; border-radius: 6px; font-size: 0.8rem; outline: none;';
                        
                        // Use preset distance if available, otherwise use default
                        if (presetDistances[i]) {
                            input.value = presetDistances[i];
                        } else {
                            input.value = (i + 2) + ' Meters';
                        }
                        
                        // Add event listener for change tracking
                        input.addEventListener('input', checkForFieldChanges);
                        input.addEventListener('change', checkForFieldChanges);
                        
                        inputDiv.appendChild(label);
                        inputDiv.appendChild(input);
                        distanceInputs.appendChild(inputDiv);
                    }
                    
                    // Mark that user has made manual changes
                    hasManualChanges = true;
                } else if (presetDistances.length > 0 && isLoadingPreset) {
                    // If preset is being loaded and inputs already exist, update their values
                    for (let i = 0; i < numDistances && i < presetDistances.length; i++) {
                        const input = document.getElementById('distance' + (i + 1));
                        if (input && presetDistances[i]) {
                            input.value = presetDistances[i];
                        }
                    }
                }
            }
            
            // Re-check for field changes after updating
            setTimeout(() => {
                isLoadingPreset = false;
                if (!distancePreset || distancePreset === '') {
                    hasManualChanges = false;
                }
                checkForFieldChanges();
            }, 100);
        }
        
        // Track the last preset that was configured to avoid resetting on every call
        let lastConfiguredPreset = null;

        function configurePresetSettings(preset) {
            // Only configure if this is a different preset than last time
            // This prevents resetting values when user is just interacting with other fields
            if (preset === lastConfiguredPreset || !preset || preset === '') {
                return;
            }
            
            lastConfiguredPreset = preset;
            
            // Get the distances for this preset to determine the number of distances
            const distances = getDefaultDistances(preset, 10); // Get up to 10 distances
            const numDistances = distances.length;
            
            // Update number of distances
            const numDistancesInput = document.getElementById('numDistances');
            if (numDistancesInput && numDistances > 0) {
                numDistancesInput.value = numDistances;
            }
            
            // Set game name based on preset
            const gameNameInput = document.getElementById('gameName');
            if (gameNameInput) {
                const presetNames = {
                    'dangerfest_am_knife': 'Dangerfest Am Knife',
                    'dangerfest_pro_knife': 'Dangerfest Pro Knife',
                    'dangerfest_am_hawk': 'Dangerfest Am Hawk',
                    'dangerfest_pro_hawk': 'Dangerfest Pro Hawk',
                    'akta': 'AKTA',
                    'blade_aces_am_knife': 'Blade Aces Am Knife',
                    'blade_aces_pro_knife': 'Blade Aces Pro Knife',
                    'blade_aces_am_hawk': 'Blade Aces Am Hawk',
                    'blade_aces_pro_hawk': 'Blade Aces Pro Hawk',
                    'amateur': 'Amateur Knife',
                    'professional': 'Professional Knife'
                };
                
                if (presetNames[preset]) {
                    gameNameInput.value = presetNames[preset];
                }
            }
            
            // Configure preset-specific settings
            if (preset.startsWith('dangerfest_')) {
                // Dangerfest presets: 4 rounds, 3 throws per round, 5 max score
                document.getElementById('roundCount').value = 4;
                document.getElementById('throwsPerRound').value = 3;
                document.getElementById('maxScore').value = 5;
            } else if (preset === 'akta') {
                // AKTA preset: 4 rounds, 5 throws per round, 5 max score
                document.getElementById('roundCount').value = 4;
                document.getElementById('throwsPerRound').value = 5;
                document.getElementById('maxScore').value = 5;
            } else if (preset.startsWith('blade_aces_')) {
                // Blade Aces presets: 4 rounds, 3 throws per round, 5 max score
                document.getElementById('roundCount').value = 4;
                document.getElementById('throwsPerRound').value = 3;
                document.getElementById('maxScore').value = 5;
            } else if (preset === 'amateur' || preset === 'professional') {
                // Legacy presets: keep current values or use defaults
                // Don't change existing values for legacy presets
            }
        }

        function getDefaultDistances(preset, count) {
            if (preset === 'dangerfest_am_knife') {
                return ['2 Meters', '3 Meters', '4 Meters', '5 Meters', '6 Meters'].slice(0, count);
            } else if (preset === 'dangerfest_pro_knife') {
                return ['3 Meters', '4 Meters', '5 Meters', '6 Meters', '7 Meters'].slice(0, count);
            } else if (preset === 'dangerfest_am_hawk') {
                return ['3 Meters', '4 Meters', '5 Meters', '7 Meters'].slice(0, count);
            } else if (preset === 'dangerfest_pro_hawk') {
                return ['3 Meters', '4 Meters', '5 Meters', '7 Meters', '9 Meters'].slice(0, count);
            } else if (preset === 'akta') {
                return ['7 Feet', '10 Feet', '13 Feet', '16 Feet'].slice(0, count);
            } else if (preset === 'blade_aces_am_knife') {
                return ['2 Meters', '3 Meters', '4 Meters', '5 Meters'].slice(0, count);
            } else if (preset === 'blade_aces_pro_knife') {
                return ['3 Meters', '4 Meters', '5 Meters', '6 Meters', '7 Meters'].slice(0, count);
            } else if (preset === 'blade_aces_am_hawk') {
                return ['3 Meters', '4 Meters', '5 Meters'].slice(0, count);
            } else if (preset === 'blade_aces_pro_hawk') {
                return ['3 Meters', '4 Meters', '5 Meters', '7 Meters', '9 Meters'].slice(0, count);
            } else if (preset === 'amateur') {
                return ['2 Meters', '3 Meters', '4 Meters', '5 Meters', '6 Meters'].slice(0, count);
            } else if (preset === 'professional') {
                return ['3 Meters', '4 Meters', '5 Meters', '6 Meters', '7 Meters'].slice(0, count);
            }
            return [];
        }

        // Custom Preset Functions
        function loadCustomPresets() {
            const presets = JSON.parse(localStorage.getItem('tripleNickel_customPresets') || '[]');
            const presetSelect = document.getElementById('distancePreset');
            
            if (!presetSelect) return;
            
            // Remove existing custom presets and separator from dropdown (keep default ones)
            const existingOptions = Array.from(presetSelect.options);
            existingOptions.forEach(option => {
                if ((option.value && option.value.startsWith('custom_')) || 
                    (option.disabled && option.textContent && option.textContent.includes('Custom Presets'))) {
                    option.remove();
                }
            });
            
            // Add custom presets to dropdown at the end
            if (presets.length > 0) {
                // Add a separator if there are custom presets
                const separator = document.createElement('option');
                separator.value = '';
                separator.disabled = true;
                separator.textContent = '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Custom Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ';
                presetSelect.appendChild(separator);
                
                // Add custom presets
                presets.forEach((preset, index) => {
                    const option = document.createElement('option');
                    option.value = 'custom_' + preset.id;
                    option.textContent = preset.name;
                    presetSelect.appendChild(option);
                });
            }
        }

        function loadCustomPreset(presetId) {
            isLoadingPreset = true;
            
            // Show delete button for custom presets
            const deleteBtn = document.getElementById('deletePresetBtn');
            if (deleteBtn) {
                deleteBtn.style.display = 'block';
            }
            
            const presets = JSON.parse(localStorage.getItem('tripleNickel_customPresets') || '[]');
            const preset = presets.find(p => 'custom_' + p.id === presetId);
            
            if (!preset) {
                isLoadingPreset = false;
                if (deleteBtn) {
                    deleteBtn.style.display = 'none';
                }
                return;
            }
            
            // Load all preset values
            document.getElementById('gameName').value = preset.gameName || '';
            document.getElementById('weaponType').value = preset.gameType || 'Knife';
            document.getElementById('discipline').value = preset.discipline || 'Rotational';
            document.getElementById('roundCount').value = preset.roundCount || 4;
            document.getElementById('throwsPerRound').value = preset.throwsPerRound || 3;
            document.getElementById('maxScore').value = preset.maxScore || 5;
            document.getElementById('numDistances').value = preset.numDistances || 5;
            
            // Handle distances
            const customInputs = document.getElementById('customDistanceInputs');
            const distanceInputs = document.getElementById('distanceInputs');
            
            if (preset.distances && preset.distances.length > 0) {
                // Show the custom distance inputs section
                customInputs.style.display = 'block';
                const toggleIcon = document.getElementById('customDistancesToggleIcon');
                if (toggleIcon) {
                    toggleIcon.textContent = '‚ñ≤';
                    toggleIcon.style.transform = 'rotate(180deg)';
                }
                
                distanceInputs.innerHTML = '';
                
                preset.distances.forEach((distance, i) => {
                    const inputDiv = document.createElement('div');
                    inputDiv.style.cssText = 'display: flex; flex-direction: column;';
                    
                    const label = document.createElement('label');
                    label.style.cssText = 'font-size: 0.8rem; color: #94a3b8; margin-bottom: 5px;';
                    label.textContent = 'Distance ' + (i + 1);
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.id = 'distance' + (i + 1);
                    input.placeholder = 'e.g., ' + (i + 2) + ' Meters';
                    input.maxLength = 20;
                    input.style.cssText = 'background: #475569; border: 1px solid #64748b; color: white; padding: 8px; border-radius: 6px; font-size: 0.8rem; outline: none;';
                    input.value = distance;
                    
                    // Add event listener for change tracking
                    input.addEventListener('input', checkForFieldChanges);
                    input.addEventListener('change', checkForFieldChanges);
                    
                    inputDiv.appendChild(label);
                    inputDiv.appendChild(input);
                    distanceInputs.appendChild(inputDiv);
                });
            } else {
                // Keep section hidden but reset toggle icon
                customInputs.style.display = 'none';
                const toggleIcon = document.getElementById('customDistancesToggleIcon');
                if (toggleIcon) {
                    toggleIcon.textContent = '‚ñº';
                    toggleIcon.style.transform = 'rotate(0deg)';
                }
            }
            
            // Hide save button since we're loading a preset
            setTimeout(() => {
                isLoadingPreset = false;
                hasManualChanges = false;
                checkForFieldChanges();
            }, 100);
        }

        function initializePresetChangeTracking() {
            // Track changes on all fields except Event Name
            const fieldsToTrack = [
                'gameName', 'weaponType', 'discipline', 'roundCount', 
                'throwsPerRound', 'maxScore', 'numDistances', 'distancePreset'
            ];
            
            fieldsToTrack.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', checkForFieldChanges);
                    field.addEventListener('input', checkForFieldChanges);
                }
            });
            
            // Also track custom distance inputs
            const distanceInputs = document.getElementById('distanceInputs');
            if (distanceInputs) {
                distanceInputs.addEventListener('input', function(e) {
                    if (e.target.tagName === 'INPUT') {
                        checkForFieldChanges();
                    }
                }, true);
            }
        }

        // Track if we're currently loading a preset (to prevent showing save button)
        let isLoadingPreset = false;
        let hasManualChanges = false;

        function checkForFieldChanges() {
            const saveContainer = document.getElementById('savePresetContainer');
            if (!saveContainer) return;
            
            // Don't show save button if we're currently loading a preset
            if (isLoadingPreset) {
                saveContainer.style.display = 'none';
                hasManualChanges = false;
                return;
            }
            
            // Mark that user has made manual changes
            hasManualChanges = true;
            
            // Check if any field (except Event Name) has been changed from default
            const distancePreset = document.getElementById('distancePreset').value;
            const customInputs = document.getElementById('customDistanceInputs');
            const hasCustomInputsVisible = customInputs && customInputs.style.display !== 'none';
            
            // Show save button if:
            // 1. User has made manual changes, OR
            // 2. Custom preset is selected, OR
            // 3. Custom distance inputs are visible
            if (hasManualChanges || (distancePreset && distancePreset.startsWith('custom_')) || hasCustomInputsVisible) {
                saveContainer.style.display = 'block';
            } else if (distancePreset && !distancePreset.startsWith('custom_') && distancePreset !== '') {
                // Built-in preset selected and no manual changes - hide button
                saveContainer.style.display = 'none';
            } else {
                // No preset selected or empty - show button if there are manual changes
                saveContainer.style.display = hasManualChanges ? 'block' : 'none';
            }
        }

        function getDefaultPresetNames() {
            return [
                'Dangerfest Am Knife',
                'Dangerfest Pro Knife',
                'Dangerfest Am Hawk',
                'Dangerfest Pro Hawk',
                'AKTA',
                'Blade Aces Am Knife',
                'Blade Aces Pro Knife',
                'Blade Aces Am Hawk',
                'Blade Aces Pro Hawk',
                'Amateur Knife',
                'Professional Knife'
            ];
        }

        function generatePresetName() {
            const gameName = document.getElementById('gameName').value.trim();
            if (!gameName) {
                return 'Custom Preset';
            }
            
            const defaultNames = getDefaultPresetNames();
            const isDefault = defaultNames.some(name => name.toLowerCase() === gameName.toLowerCase());
            
            return isDefault ? gameName + ' Copy' : gameName;
        }

        function showSavePresetModal() {
            const modal = document.getElementById('savePresetModal');
            const presetNameDisplay = document.getElementById('presetNameDisplay');
            const errorDiv = document.getElementById('presetNameError');
            
            if (modal) {
                const presetName = generatePresetName();
                if (presetNameDisplay) {
                    presetNameDisplay.textContent = presetName;
                }
                if (errorDiv) {
                    errorDiv.style.display = 'none';
                    errorDiv.textContent = '';
                }
                modal.style.display = 'block';
            }
        }

        function saveCustomPreset() {
            const errorDiv = document.getElementById('presetNameError');
            
            // Generate preset name from Game Name
            let presetName = generatePresetName();
            
            // Get current form values (except Event Name)
            const gameName = document.getElementById('gameName').value.trim();
            const gameType = document.getElementById('weaponType').value;
            const discipline = document.getElementById('discipline').value;
            const roundCount = parseInt(document.getElementById('roundCount').value);
            const throwsPerRound = parseInt(document.getElementById('throwsPerRound').value);
            const maxScore = parseInt(document.getElementById('maxScore').value);
            const numDistances = parseInt(document.getElementById('numDistances').value);
            
            // Get distances
            let distances = [];
            const customInputs = document.getElementById('customDistanceInputs');
            if (customInputs && customInputs.style.display !== 'none') {
                for (let i = 0; i < numDistances; i++) {
                    const input = document.getElementById('distance' + (i + 1));
                    if (input) {
                        distances.push(input.value || (i + 2) + ' Meters');
                    }
                }
            } else {
                // Get distances from current preset
                const distancePreset = document.getElementById('distancePreset').value;
                if (distancePreset && !distancePreset.startsWith('custom_')) {
                    distances = getDefaultDistances(distancePreset, numDistances);
                } else if (distancePreset && distancePreset.startsWith('custom_')) {
                    // Custom preset selected - get distances from preset
                    const presets = JSON.parse(localStorage.getItem('tripleNickel_customPresets') || '[]');
                    const preset = presets.find(p => 'custom_' + p.id === distancePreset);
                    if (preset && preset.distances) {
                        distances = preset.distances;
                    } else {
                        distances = getDefaultDistances('dangerfest_pro_knife', numDistances);
                    }
                }
            }
            
            // Load existing presets
            const presets = JSON.parse(localStorage.getItem('tripleNickel_customPresets') || '[]');
            
            // Check for duplicate name and append number if needed
            let finalPresetName = presetName;
            let counter = 1;
            while (presets.some(p => p.name.toLowerCase() === finalPresetName.toLowerCase())) {
                const baseName = presetName.replace(/\s+Copy(\s+\d+)?$/, '');
                finalPresetName = baseName + ' Copy' + (counter > 1 ? ' ' + counter : '');
                counter++;
            }
            
            // Create preset object
            const preset = {
                id: Date.now().toString(),
                name: finalPresetName,
                gameName: gameName,
                gameType: gameType,
                discipline: discipline,
                roundCount: roundCount,
                throwsPerRound: throwsPerRound,
                maxScore: maxScore,
                numDistances: numDistances,
                distances: distances
            };
            
            // Add new preset
            presets.push(preset);
            
            // Save to localStorage
            localStorage.setItem('tripleNickel_customPresets', JSON.stringify(presets));
            
            // Reload presets in dropdown
            loadCustomPresets();
            
            // Select the new preset
            document.getElementById('distancePreset').value = 'custom_' + preset.id;
            
            // Close modal
            closeModal('savePresetModal');
            
            // Hide save button and reset manual changes flag
            const saveContainer = document.getElementById('savePresetContainer');
            if (saveContainer) {
                saveContainer.style.display = 'none';
            }
            hasManualChanges = false;
        }

        // Store the preset ID to delete when confirmed
        let presetToDelete = null;

        function deleteCustomPreset() {
            const distancePreset = document.getElementById('distancePreset').value;
            
            // Only allow deletion of custom presets
            if (!distancePreset || !distancePreset.startsWith('custom_')) {
                return;
            }
            
            // Get preset ID and name
            const presetId = distancePreset.replace('custom_', '');
            const presetName = document.getElementById('distancePreset').options[document.getElementById('distancePreset').selectedIndex].textContent;
            
            // Store the preset ID for deletion
            presetToDelete = presetId;
            
            // Show the delete confirmation modal
            const modal = document.getElementById('deletePresetModal');
            const presetNameDisplay = document.getElementById('deletePresetName');
            
            if (modal && presetNameDisplay) {
                presetNameDisplay.textContent = presetName;
                modal.style.display = 'block';
            }
        }

        function confirmDeletePreset() {
            if (!presetToDelete) {
                closeModal('deletePresetModal');
                return;
            }
            
            // Load existing presets
            const presets = JSON.parse(localStorage.getItem('tripleNickel_customPresets') || '[]');
            
            // Remove the preset
            const filteredPresets = presets.filter(p => p.id !== presetToDelete);
            
            // Save to localStorage
            localStorage.setItem('tripleNickel_customPresets', JSON.stringify(filteredPresets));
            
            // Reload presets in dropdown
            loadCustomPresets();
            
            // Reset to placeholder
            document.getElementById('distancePreset').value = '';
            updateDistanceInputs();
            
            // Hide delete button
            const deleteBtn = document.getElementById('deletePresetBtn');
            if (deleteBtn) {
                deleteBtn.style.display = 'none';
            }
            
            // Clear the preset to delete
            presetToDelete = null;
            
            // Close the modal
            closeModal('deletePresetModal');
        }

        function toggleCustomDistances() {
            const customInputs = document.getElementById('customDistanceInputs');
            const toggleIcon = document.getElementById('customDistancesToggleIcon');
            const distanceInputs = document.getElementById('distanceInputs');
            const numDistances = parseInt(document.getElementById('numDistances').value) || 5;
            const distancePreset = document.getElementById('distancePreset').value;
            
            if (!customInputs || !toggleIcon) return;
            
            const isVisible = customInputs.style.display !== 'none';
            
            if (isVisible) {
                // Hide the section
                customInputs.style.display = 'none';
                toggleIcon.textContent = '‚ñº';
                toggleIcon.style.transform = 'rotate(0deg)';
            } else {
                // Show the section
                customInputs.style.display = 'block';
                toggleIcon.textContent = '‚ñ≤';
                toggleIcon.style.transform = 'rotate(180deg)';
                
                // Always update inputs to match current numDistances value
                if (distanceInputs) {
                    // Clear existing inputs
                    distanceInputs.innerHTML = '';
                    
                    // Get preset distances if a preset is selected
                    let presetDistances = [];
                    if (distancePreset && !distancePreset.startsWith('custom_') && distancePreset !== '') {
                        presetDistances = getDefaultDistances(distancePreset, numDistances);
                    }
                    
                    // Create the correct number of inputs based on numDistances
                    for (let i = 0; i < numDistances; i++) {
                        const inputDiv = document.createElement('div');
                        inputDiv.style.cssText = 'display: flex; flex-direction: column;';
                        
                        const label = document.createElement('label');
                        label.style.cssText = 'font-size: 0.8rem; color: #94a3b8; margin-bottom: 5px;';
                        label.textContent = 'Variable ' + (i + 1);
                        
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.id = 'distance' + (i + 1);
                        input.placeholder = 'e.g., ' + (i + 2) + ' Meters';
                        input.maxLength = 20;
                        input.style.cssText = 'background: #475569; border: 1px solid #64748b; color: white; padding: 8px; border-radius: 6px; font-size: 0.8rem; outline: none;';
                        
                        // Use preset distance if available, otherwise use default
                        if (presetDistances[i]) {
                            input.value = presetDistances[i];
                        } else {
                            input.value = (i + 2) + ' Meters';
                        }
                        
                        // Add event listener for change tracking
                        input.addEventListener('input', checkForFieldChanges);
                        input.addEventListener('change', checkForFieldChanges);
                        
                        inputDiv.appendChild(label);
                        inputDiv.appendChild(input);
                        distanceInputs.appendChild(inputDiv);
                    }
                }
                
                // Mark that user has made manual changes
                hasManualChanges = true;
                checkForFieldChanges();
            }
        }

        function generateScoreSheet() {
            // Get form values with defaults
            const gameName = document.getElementById('gameName').value.trim() || 'Custom Game';
            const eventName = document.getElementById('eventName').value.trim() || '';
            const gameType = document.getElementById('weaponType').value;
            const discipline = document.getElementById('discipline').value;
            const roundCount = parseInt(document.getElementById('roundCount').value);
            const throwsPerRound = parseInt(document.getElementById('throwsPerRound').value);
            const maxScore = parseInt(document.getElementById('maxScore').value);
            const distancePreset = document.getElementById('distancePreset').value;
            const numDistances = parseInt(document.getElementById('numDistances').value);
            
            // Get distances
            let distances = [];
            const customInputs = document.getElementById('customDistanceInputs');
            const hasCustomInputs = customInputs && customInputs.style.display !== 'none';
            
            // Check if custom distance inputs are visible and have values
            if (hasCustomInputs) {
                let hasCustomValues = false;
                for (let i = 0; i < numDistances; i++) {
                    const input = document.getElementById('distance' + (i + 1));
                    if (input && input.value.trim()) {
                        hasCustomValues = true;
                        distances.push(input.value.trim());
                    } else {
                        distances.push((i + 2) + ' Meters');
                    }
                }
                
                // If no custom values were entered, use preset distances
                if (!hasCustomValues && distancePreset && !distancePreset.startsWith('custom_')) {
                    distances = getDefaultDistances(distancePreset, numDistances);
                }
            } else if (distancePreset && distancePreset.startsWith('custom_')) {
                // Custom preset selected - get distances from preset
                const presets = JSON.parse(localStorage.getItem('tripleNickel_customPresets') || '[]');
                const preset = presets.find(p => 'custom_' + p.id === distancePreset);
                if (preset && preset.distances) {
                    distances = preset.distances;
                } else {
                    distances = getDefaultDistances('dangerfest_pro_knife', numDistances);
                }
            } else {
                // Use preset distances
                distances = getDefaultDistances(distancePreset, numDistances);
            }

            // If no distances were determined (no preset selected and no custom distances), use defaults
            if (distances.length === 0) {
                // Use default distances based on number of distances
                for (let i = 0; i < numDistances; i++) {
                    distances.push((i + 2) + ' Meters');
                }
            }

            // Generate HTML score sheet
            generateHTMLScoreSheet({
                gameName, eventName, gameType, discipline, roundCount, 
                throwsPerRound, maxScore, distances, numDistances
            });
        }

        // HTML Score Sheet Generator
        function generateHTMLScoreSheet(config) {
            const { gameName, eventName, gameType, discipline, roundCount, 
                    throwsPerRound, maxScore, distances, numDistances } = config;
            
            // Create HTML content with print-optimized CSS
            const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${gameName} - Score Sheet</title>
    <style>
        /* Print-optimized CSS */
        @page {
            size: A4;
            margin: 0.5in;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: #000;
            background: white;
        }
        
        .score-sheet {
            width: 100%;
            max-width: 8.5in;
            margin: 0 auto;
            padding: 15px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 2px solid #333;
            padding-bottom: 8px;
        }
        
        .game-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 10px;
        }
        
        .info-section h3 {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .info-line {
            margin-bottom: 4px;
        }
        
        .player-info {
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 20px;
        }
        
        .player-fields {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .field {
            border-bottom: 1px solid #333;
            padding-bottom: 2px;
            font-size: 10px;
        }
        
        .scoring-section {
            margin-top: 10px;
        }
        
        .distance-block {
            margin-bottom: 12px;
            page-break-inside: avoid;
        }
        
        .distance-label {
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .rounds-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(${Math.max(50, (maxScore + 1) * 12 + 15)}px, 1fr));
            gap: 8px;
        }
        
        .round-column {
            border: 1px solid #333;
            padding: 5px;
        }
        
        .round-header {
            text-align: center;
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 8px;
            background: #f8f8f8;
            padding: 3px;
        }
        
        .throw-row {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            min-height: 20px;
        }
        
        .throw-label {
            font-size: 9px;
            font-weight: bold;
            width: 20px;
            flex-shrink: 0;
        }
        
        .score-boxes {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
        }
        
        .score-box {
            width: 18px;
            height: 18px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            background: white;
        }
        
        
        .footer {
            margin-top: 15px;
            text-align: center;
            font-size: 8px;
            color: #666;
            border-top: 1px solid #ccc;
            padding-top: 6px;
        }
        
        /* Print-specific styles */
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .score-sheet {
                padding: 10px;
                font-size: 11px;
            }
            
            .distance-block {
                page-break-inside: avoid;
                margin-bottom: 10px;
            }
            
            .header {
                margin-bottom: 8px;
                padding-bottom: 6px;
            }
            
            .game-info {
                margin-bottom: 8px;
            }
            
            .scoring-section {
                margin-top: 8px;
            }
            
            .footer {
                margin-top: 10px;
                padding-top: 4px;
            }
        }
        
        /* Responsive adjustments for different score ranges */
        ${maxScore > 10 ? `
        .rounds-container {
            grid-template-columns: 1fr;
        }
        .score-boxes {
            flex-wrap: wrap;
        }
        ` : ''}
        
        ${maxScore <= 3 ? `
        .rounds-container {
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        }
        ` : ''}
    </style>
</head>
<body>
    <div class="score-sheet">
        <div class="header">
            <div class="game-title">${gameName}</div>
            <div class="subtitle">Individual Player Score Sheet</div>
        </div>
        
        <div class="game-info">
            <div class="info-section">
                <h3>Game Information</h3>
                <div class="info-line"><strong>Event:</strong> ${eventName}</div>
                <div class="info-line"><strong>Game Type:</strong> ${gameType} | <strong>Discipline:</strong> ${discipline}</div>
                <div class="info-line"><strong>Date:</strong> ${new Date().toLocaleDateString()}</div>
            </div>
            
            <div class="info-section">
                <h3>Player Information</h3>
                <div class="player-fields">
                    <div class="field">Name: _________________</div>
                    <div class="field">Division: _____________</div>
                    <div class="field">Event: _______________</div>
                </div>
            </div>
        </div>
        
        <div class="scoring-section">
            <h3 style="text-align: center; margin-bottom: 10px; font-size: 14px;">SCORING SHEET</h3>
            
            ${distances.map((distance, index) => `
            <div class="distance-block">
                <div class="distance-label">${distance}:</div>
                <div class="rounds-container">
                    ${Array.from({length: roundCount}, (_, roundIndex) => `
                    <div class="round-column">
                        <div class="round-header">Round ${roundIndex + 1}</div>
                        ${Array.from({length: throwsPerRound}, (_, throwIndex) => `
                        <div class="throw-row">
                            <div class="throw-label">T${throwIndex + 1}:</div>
                            <div class="score-boxes">
                                ${Array.from({length: maxScore + 1}, (_, score) => `
                                <div class="score-box">${score}</div>
                                `).join('')}
                            </div>
                        </div>
                        `).join('')}
                    </div>
                    `).join('')}
                </div>
            </div>
            `).join('')}
        </div>
        
        <div class="footer">
            Generated by Triple Nickel Competition System<br>
            Created by Aaron Shour @ Modern Methods and Materials
        </div>
    </div>
</body>
</html>`;

            // Create and download HTML file
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `triple-nickel-score-sheet-${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Show success modal
            showSuccessModal(a.download);
        }

        // Success modal functions
        function showSuccessModal(filename) {
            // Set the filename in the modal
            const filenameElement = document.getElementById('generatedFileName');
            if (filenameElement) {
                filenameElement.textContent = filename;
            }
            
            // Set the max score information in the modal
            const maxScoreElement = document.getElementById('generatedMaxScore');
            const maxScoreRangeElement = document.getElementById('generatedMaxScoreRange');
            const formatRangeElement = document.getElementById('generatedFormatRange');
            const layoutElement = document.getElementById('generatedLayout');
            const maxScore = parseInt(document.getElementById('maxScore').value);
            
            if (maxScoreElement) {
                maxScoreElement.textContent = maxScore;
            }
            if (maxScoreRangeElement) {
                maxScoreRangeElement.textContent = maxScore;
            }
            if (formatRangeElement) {
                formatRangeElement.textContent = `0-${maxScore}`;
            }
            
            // Update content for HTML format
            const fileLocationInfo = document.getElementById('fileLocationInfo');
            if (fileLocationInfo) {
                fileLocationInfo.innerHTML = `
                    <h3 style="color: #3b82f6; margin-bottom: 15px; font-size: 1.2rem;">üåê Using Your HTML Score Sheet</h3>
                    <div style="text-align: left; color: #e2e8f0;">
                        <p style="margin-bottom: 8px; font-size: 0.95rem;">
                            <strong>üìÇ Location:</strong> Check your Downloads folder for the HTML file.
                        </p>
                        <p style="margin-bottom: 8px; font-size: 0.95rem;">
                            <strong>üñ®Ô∏è To Print:</strong> Double-click the HTML file to open in your browser, then use Ctrl+P (Cmd+P on Mac).
                        </p>
                        <p style="margin-bottom: 8px; font-size: 0.95rem;">
                            <strong>üìÑ Save as PDF:</strong> When printing, select "Save as PDF" as your printer destination.
                        </p>
                        <p style="margin-bottom: 0; font-size: 0.95rem;">
                            <strong>‚ú® Benefits:</strong> Perfect text wrapping, responsive layout, and professional print quality.
                        </p>
                    </div>
                `;
            }
                         if (layoutElement) {
                             const throwsPerRound = parseInt(document.getElementById('throwsPerRound').value);
                             if (maxScore <= 5) {
                                 layoutElement.textContent = `0-${maxScore} selection boxes for each throw (${throwsPerRound} throws per round) - Professional layout`;
                                 layoutElement.style.color = '#10b981'; // Green for optimized layouts
                             } else if (maxScore <= 10) {
                                 layoutElement.textContent = `0-${maxScore} selection boxes for each throw (${throwsPerRound} throws per round) - Clear organization`;
                                 layoutElement.style.color = '#3b82f6'; // Blue for balanced layouts
                             } else {
                                 layoutElement.textContent = `0-${maxScore} selection boxes for each throw (${throwsPerRound} throws per round) - Maximum readability`;
                                 layoutElement.style.color = '#f59e0b'; // Orange for professional layouts
                             }
                         }
            
            // Show the modal
            openModal('successModal');
        }
        


        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            const toggle = document.getElementById('sidebarToggle');
            
            if (sidebar && mainContent && toggle) {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
                
                // Update toggle button position
                if (sidebar.classList.contains('collapsed')) {
                    toggle.style.left = '0';
                } else {
                    toggle.style.left = 'clamp(250px, 20vw, 300px)';
                }
            }
        }

          </script>
      
     <script src="shared-sidebar.js"></script>
</body>
</html>
